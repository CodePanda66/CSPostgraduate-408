---
title: 文件系统基础
---

## 文件的基本概念

## 1、文件的基本概念

### 1.1、什么是文件

文件是具有文件名的一组相关元素的集合，在文件系统中是一个最大的数据单位。

自底向上的文件组成结构：

+ 数据项：数据项是文件系统中最低级的数据组织形式，包括以下两类：
  + 基本数据项：用于描述一个对象的某种属性值，如姓名，日期等，是数据中可重命名的**最小逻辑数据单位**，即原子数据。
  + 组合数据项：由多个基本数据项组成
+ 记录：是一组相关数据项的集合，用于描述一个对象在某方面的属性，如一个考生的基本信息
+ 文件：由创建者所定义的一组相关信息的集合。

### 1.2、文件的属性

+ 名称
+ 标识符：对用户透明
+ 文件类型
+ 文件位置
+ 文件大小、建立时间、用户标识等

### 1.3、文件分类

1. 按用途分
   + 系统文件：一般只允许用户调用执行，不允许修改
   + 库文件：系统提供给用户的各种标准过程，函数和应用程序文件。
   + 用户文件
2. 按保护级别分
   + 只读文件
   + 读写文件
   + 执行文件：允许调用执行，不允许修改
   + 不保护文件
3. 按信息流向分
   + 输入文件
   + 输出文件
   + 输入/输出文件
4. 按数据形式分
   + 源文件：由源程序和数据构成的文件
   + 目标文件：经过编译但尚未链接的目标代码形成的文件
   + 可执行文件

### 1.4、文件的操作

1. 基本操作
   + 创建文件
   + 删除文件
   + 读文件
   + 写文件
   + 截断文件：保持文件属性不变，删除文件内容
   + 设置文件读/写位置
2. 打开/关闭操作
   + 打开文件：系统将文件的属性从外存复制到内存，并设定一个**编号**（或索引）返回给用户。
     文件打开过程涉及的信息：文件指针、文件打开计数、文件磁盘位置、访问权限
   + 删除文件：系统将文件编号（缩影）删除，并销毁其文件控制块。

## 2、文件结构

+ 逻辑结构：

### 2.1、文件的逻辑结构
从用户观点来观察到的文件的组织形式，是用户可以直接处理的数据及其结构。

从逻辑结构上，文件可分为：

  + 有结构的**记录式文件**：如顺序、索引、索引顺序等。
  + 无结构的**流式文件**

记录式文件：有结构的、由若干个记录组成的文件。记录是一些相关数据项的集合，而**数据项是可以命名的最小逻辑单位**

+ 等长记录文件：所有记录的长度相等。
+ 变长记录文件：所有记录的长度可以不等。 

#### 2.1.1、顺序文件

以顺序结构存放的文件。顺序结构又称连续结构——将一逻辑文件的信息连续存放。

1. 按记录是否定长，分为**定长记录顺序文件**和**变长记录顺序文件**
2. 按文件中记录是否按照关键字排序，分为串结构和顺序结构，其中串结构中各记录之间的顺序与关键字无关。

+ 优点：顺序存取时速度快，若为定长记录顺序文件，可以实现随机访问。
+ 缺点：会产生碎片，也不利于文件动态扩充。

#### 2.1.2、索引文件

索引结构为一个逻辑文件信息建立一个索引表。索引表中的表目存放文件记录的长度和所在逻辑文件的起始位置。索引表本身是一个定长文件。

+ 优点：可以进行随机访问，易于进行文件增删
+ 缺点：增加了存储空间的开销，索引表的查找策略对文件系统的效率影响很大

#### 2.1.3、索引顺序文件

将顺序文件中的所有记录分为若干组，为顺序文件建立一张索引表，并为每组的第一个记录在索引表建立一个索引项，其中包含该记录的关键字和指向该记录的指针。索引项按关键字排序，但每一项的逻辑文件是一个顺序文件。

+ 优点：大大提升了顺序存取的速度，
+ 缺点：索引表还是会增加存储开销

#### 2.1.4、直接文件和散列文件

直接文件：建立关键字和相应记录物理地址之间的对应关系，可直接通过关键字找到物理地址。

散列文件是一种典型的直接文件。

优点：有很高的存取速度

缺点：会因不同关键字的散列函数值相同而引起冲突。

### 2.2、文件的物理结构

从计算机角度观察，文件在外存上的存放组织形式被称为文件的物理结构。

从物理结构上，文件的组织形式有连续分配、链接分配和索引分配。 

文件存储设备通常划分为大小相等的物理块，**物理块是分配及传输信息的基本单位**。**物理块的大小与设备有关，但与逻辑记录的大小无关**

为了有效地利用外存设备和便于系统管理，一般也把文件信息划分为与物理存储块大小相等的逻辑块。

## 3、目录结构

### 3.1、文件目录

文件目录也作为一个文件来处理。

目录的基本功能：

+ 按名存取
+ 提高检索速度
+ 允许文件同名
+ 允许文件共享

### 3.2、文件控制块和索引结点

从文件管理的角度看，文件由文件控制块（File Control Block，FCB）和文件体两部分组成。

#### 3.2.1、文件控制块

+ 文件名
+ 文件结构
+ 文件物理地址
+ 存取控制信息
+ 管理信息（建立时间，上次存取时间以及当前文件状态）

#### 3.2.2、索引结点

在检索目录文件的过程中，只用到了文件名，仅当找到匹配目录项时，才需要从该目录中读出该文件的物理地址。

存放在磁盘上的索引结点称为磁盘索引结点，每个文件都有唯一的磁盘索引结点，其主要内容包括：

+ 文件主标识符
+ 文件类型
+ 文件存取权限
+ 文件物理地址
+ 文件长度
+ 文件链接计数：所有指向该文件的文件名计数
+ 文件存取时间

当文件被打开时，磁盘索引结点被复制到内存的索引结点中，以便使用。存放在内存中的索引结点称为内存索引结点，其包括以下内容：

+ 索引结点编号
+ 状态
+ 访问计数
+ 逻辑设备号
+ 链接指针

### 3.3、单级目录结构



